{% extends "base.html" %}

{% block content %}
    <main role="main">
        <section id="chat" class="container">

        </section>
        <section id="prompt">
            <form name="ajaxForm" method="post">
                <div class="row justify-content-center">
                    <div class="col-7">
                            <label class="sr-only" for="textUserMessage">Votre Message</label>
                            <input type="text" class="form-control mb-2 mr-sm-2" name="usermsg" id="textUserMessage"
                                   placeholder="Tapez votre message">
                        </div>
                        <div class="col-1">
                            <button type="button" id="ajaxButton" class="btn mb-2">Envoyer</button>
                        </div>
                </div>
            </form>
        </section>
    </main>
{% endblock %}
{% block script %}
    <script type="text/javascript">
    /////// gpb javascript library calls ///////
    gpbLib.addGpbBubble("Bonjour Poussin, qu'est ce que je peux faire pour toi?", "success"); //init gpb bubble

    document.getElementById("ajaxButton").addEventListener("click", function () { // ajax post on ajaxButton click event
        let usermsg = document.getElementById("textUserMessage").value;
        let data = JSON.stringify({userMessage: usermsg});
        gpbLib.ajaxPost("/index", data, success, error, progress);
    });

    function success(data, results) { // if post data sent retrieve parsed data result from user_message in views.py
        gpbLib.addUserBubble();
        {#console.log(data);#}
        {#console.log(results);#}
        let resultVal = Object.values(results);
        if (resultVal[0] === "error"){
            gpbLib.addGpbBubble("Erreur", "error"); // display an error message if parsing failed
        }else{ // display google map then wikipedia infos
            gpbLib.addGpbBubble("Bien, laisse moi retrouver le plan", "success");
        }
    }

    function error(err, txt) { // if server error
        {#console.log(err, txt)#}
    }

    function progress(state) { // before success

    }
    </script>
{% endblock %}